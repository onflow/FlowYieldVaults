
[1/10] Running all preset scenarios (extreme, gradual, volatile)...
Running all preset scenarios...
Running test: testExtremePriceMovements

======================================================================
|== AUTO-BORROW SCENARIO: Extreme FLOW Price Volatility
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| [PRICE UPDATE] Setting MOET price
|    Token Identifier: A.0000000000000008.MOET.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Creating position with 1000 FLOW...
Using position ID: 1
Initial position health: 1.30000000

======================================================================
|== Stage 0: FLOW drops 50% to 0.5
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.65000000
Triggering rebalance...
Health after rebalance: 0.86666666

======================================================================
| POSITION STATE: After price = 0.50000000
======================================================================
| Position ID: 1
| Health Ratio: 0.86666666
======================================================================
| PRICES:
|   FLOW: 0.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 461.53846154 (BORROWED)
|   -> Value: 461.53846154 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 500.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 400.00000000 MOET
|   Utilization Rate: 115.38461500%
======================================================================


======================================================================
|== Stage 1: FLOW crashes 90% to 0.1
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.10000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.17333333
Triggering rebalance...
Health after rebalance: 0.19597989

======================================================================
| POSITION STATE: After price = 0.10000000
======================================================================
| Position ID: 1
| Health Ratio: 0.19597989
======================================================================
| PRICES:
|   FLOW: 0.10000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 408.20512805 (BORROWED)
|   -> Value: 408.20512805 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 100.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 80.00000000 MOET
|   Utilization Rate: 510.25641000%
======================================================================


======================================================================
|== Stage 2: FLOW recovers to 2.0 (2x original)
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 2.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 3.91959799
Triggering rebalance...
Health after rebalance: 1.30000000

======================================================================
| POSITION STATE: After price = 2.00000000
======================================================================
| Position ID: 1
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 2.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1230.76923076 (BORROWED)
|   -> Value: 1230.76923076 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 2000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 1600.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================


======================================================================
|== Stage 3: FLOW moons to 5.0 (5x original)
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 5.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 3.25000000
Triggering rebalance...
Health after rebalance: 1.30000000

======================================================================
| POSITION STATE: After price = 5.00000000
======================================================================
| Position ID: 1
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 5.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 3076.92307692 (BORROWED)
|   -> Value: 3076.92307692 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 5000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 4000.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================


======================================================================
|== Stage 4: FLOW crashes back to 0.25
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.25000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.06500000
Triggering rebalance...
Health after rebalance: 0.06824146

======================================================================
| POSITION STATE: After price = 0.25000000
======================================================================
| Position ID: 1
| Health Ratio: 0.06824146
======================================================================
| PRICES:
|   FLOW: 0.25000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 2930.76923077 (BORROWED)
|   -> Value: 2930.76923077 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 250.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 200.00000000 MOET
|   Utilization Rate: 1465.38461500%
======================================================================


======================================================================
|== Stage 5: FLOW stabilizes at 1.0
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.27296587
Triggering rebalance...
Health after rebalance: 0.32725200

======================================================================
| POSITION STATE: After price = 1.00000000
======================================================================
| Position ID: 1
| Health Ratio: 0.32725200
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 2444.59922841 (BORROWED)
|   -> Value: 2444.59922841 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 800.00000000 MOET
|   Utilization Rate: 305.57490300%
======================================================================


======================================================================
|== AUTO-BALANCER SCENARIO: Gradual YieldToken Price Changes
======================================================================

Creating Tide with TracerStrategy...
Initial AutoBalancer balance: 615.38461538 YieldToken

======================================================================
|== Stage 0: YieldToken +10% to 1.1
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.10000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.10000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 676.92307691
|   -> Value in USD: 676.92307691
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~559.44055943
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 109.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.10000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 676.92307691
|   -> Value in USD: 676.92307691
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~559.44055943
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 109.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Balance UNCHANGED

======================================================================
|== Stage 1: YieldToken +20% to 1.2
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.20000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.20000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 738.46153845
|   -> Value in USD: 738.46153845
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~512.82051281
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 119.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.20000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 738.46153845
|   -> Value in USD: 738.46153845
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~512.82051281
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 119.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Balance UNCHANGED

======================================================================
|== Stage 2: YieldToken +30% to 1.3
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.30000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.30000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 799.99999999
|   -> Value in USD: 799.99999999
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~473.37278106
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 129.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.30000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 799.99999999
|   -> Value in USD: 799.99999999
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~473.37278106
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 129.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Balance UNCHANGED

======================================================================
|== Stage 3: YieldToken +40% to 1.4
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.40000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.40000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 861.53846153
|   -> Value in USD: 861.53846153
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~439.56043955
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 139.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.40000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 861.53846153
|   -> Value in USD: 861.53846153
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~439.56043955
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 139.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Balance UNCHANGED

======================================================================
|== Stage 4: YieldToken +50% to 1.5
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 923.07692307
|   -> Value in USD: 923.07692307
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~410.25641025
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 150.00000000%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 923.07692307
|   -> Value in USD: 923.07692307
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~410.25641025
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 150.00000000%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Balance UNCHANGED

======================================================================
|== Stage 5: YieldToken drops to 1.3
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.30000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.30000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 799.99999999
|   -> Value in USD: 799.99999999
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~473.37278106
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 129.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.30000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 799.99999999
|   -> Value in USD: 799.99999999
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~473.37278106
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 129.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Balance UNCHANGED

======================================================================
|== Stage 6: YieldToken drops to 1.1
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.10000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.10000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 676.92307691
|   -> Value in USD: 676.92307691
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~559.44055943
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 109.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.10000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 676.92307691
|   -> Value in USD: 676.92307691
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~559.44055943
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 109.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Balance UNCHANGED

======================================================================
|== Stage 7: YieldToken drops to 0.9
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 0.90000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 0.90000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 553.84615384
|   -> Value in USD: 553.84615384
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~683.76068375
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 89.99999900%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 0.90000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 589.08612750
|   -> Value in MOET: 530.17751475
|   -> Value in USD: 530.17751475
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~683.76068375
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 86.15384600%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

[WARNING] Potential underflow in balance change
|    Attempting: 589.08612750 - 615.38461538
|    Result would be negative, returning absolute difference
Balance DECREASED by: 26.29848788

======================================================================
|== Stage 8: YieldToken drops to 0.7
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 0.70000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 0.70000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 589.08612750
|   -> Value in MOET: 412.36028925
|   -> Value in USD: 412.36028925
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~879.12087911
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 67.00854700%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 0.70000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 456.72670393
|   -> Value in MOET: 319.70869275
|   -> Value in USD: 319.70869275
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~879.12087911
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 51.95266200%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

[WARNING] Potential underflow in balance change
|    Attempting: 456.72670393 - 615.38461538
|    Result would be negative, returning absolute difference
Balance DECREASED by: 158.65791145

======================================================================
|== Stage 9: YieldToken drops to 0.5
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 0.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 0.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 456.72670393
|   -> Value in MOET: 228.36335196
|   -> Value in USD: 228.36335196
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~1230.76923076
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 37.10904400%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 0.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 281.06258702
|   -> Value in MOET: 140.53129351
|   -> Value in USD: 140.53129351
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~1230.76923076
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 22.83633500%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

[WARNING] Potential underflow in balance change
|    Attempting: 281.06258702 - 615.38461538
|    Result would be negative, returning absolute difference
Balance DECREASED by: 334.32202836

======================================================================
|== AUTO-BORROW SCENARIO: Volatile Price Swings
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| [PRICE UPDATE] Setting MOET price
|    Token Identifier: A.0000000000000008.MOET.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Creating position with 1000 FLOW...
Using position ID: 1
Initial position health: 0.32725200

======================================================================
|== Stage 0: FLOW pumps to 1.5
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.49087800
Triggering rebalance...
Health after rebalance: 0.64168558

======================================================================
| POSITION STATE: After price = 1.50000000
======================================================================
| Position ID: 1
| Health Ratio: 0.64168558
======================================================================
| PRICES:
|   FLOW: 1.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1870.07473137 (BORROWED)
|   -> Value: 1870.07473137 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1500.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 1200.00000000 MOET
|   Utilization Rate: 155.83956000%
======================================================================


======================================================================
|== Stage 1: FLOW dumps to 0.7
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.70000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.29945327
Triggering rebalance...
Health after rebalance: 0.36398318

======================================================================
| POSITION STATE: After price = 0.70000000
======================================================================
| Position ID: 1
| Health Ratio: 0.36398318
======================================================================
| PRICES:
|   FLOW: 0.70000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1538.53261966 (BORROWED)
|   -> Value: 1538.53261966 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 700.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 560.00000000 MOET
|   Utilization Rate: 274.73796700%
======================================================================


======================================================================
|== Stage 2: FLOW pumps to 1.8
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.80000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.93595675
Triggering rebalance...
Health after rebalance: 1.17231202

======================================================================
| POSITION STATE: After price = 1.80000000
======================================================================
| Position ID: 1
| Health Ratio: 1.17231202
======================================================================
| PRICES:
|   FLOW: 1.80000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1228.34192144 (BORROWED)
|   -> Value: 1228.34192144 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1800.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 1440.00000000 MOET
|   Utilization Rate: 85.30152200%
======================================================================


======================================================================
|== Stage 3: FLOW crashes to 0.4
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.40000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.26051378
Triggering rebalance...
Health after rebalance: 0.31022297

======================================================================
| POSITION STATE: After price = 0.40000000
======================================================================
| Position ID: 1
| Health Ratio: 0.31022297
======================================================================
| PRICES:
|   FLOW: 0.40000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1031.51612831 (BORROWED)
|   -> Value: 1031.51612831 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 400.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 320.00000000 MOET
|   Utilization Rate: 322.34879000%
======================================================================


======================================================================
|== Stage 4: FLOW recovers to 1.2
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.20000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.93066891
Triggering rebalance...
Health after rebalance: 1.16828317

======================================================================
| POSITION STATE: After price = 1.20000000
======================================================================
| Position ID: 1
| Health Ratio: 1.16828317
======================================================================
| PRICES:
|   FLOW: 1.20000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 821.71858607 (BORROWED)
|   -> Value: 821.71858607 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1200.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 960.00000000 MOET
|   Utilization Rate: 85.59568600%
======================================================================


======================================================================
|== Stage 5: FLOW drops to 0.9
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.90000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.87621238
Triggering rebalance...
Health after rebalance: 1.12294708

======================================================================
| POSITION STATE: After price = 0.90000000
======================================================================
| Position ID: 1
| Health Ratio: 1.12294708
======================================================================
| PRICES:
|   FLOW: 0.90000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 641.17001424 (BORROWED)
|   -> Value: 641.17001424 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 900.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 720.00000000 MOET
|   Utilization Rate: 89.05139000%
======================================================================


======================================================================
|== Stage 6: FLOW moons to 2.5
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 2.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 3.11929746
Triggering rebalance...
Health after rebalance: 1.30000000

======================================================================
| POSITION STATE: After price = 2.50000000
======================================================================
| Position ID: 1
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 2.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1538.46153846 (BORROWED)
|   -> Value: 1538.46153846 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 2500.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 2000.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================


======================================================================
|== Stage 7: FLOW crashes to 0.3
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.30000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.15600000
Triggering rebalance...
Health after rebalance: 0.17441860

======================================================================
| POSITION STATE: After price = 0.30000000
======================================================================
| Position ID: 1
| Health Ratio: 0.17441860
======================================================================
| PRICES:
|   FLOW: 0.30000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1376.00000000 (BORROWED)
|   -> Value: 1376.00000000 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 300.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 240.00000000 MOET
|   Utilization Rate: 573.33333300%
======================================================================


======================================================================
|== Stage 8: FLOW stabilizes at 1.0
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.58139534
Triggering rebalance...
Health after rebalance: 0.77232592

======================================================================
| POSITION STATE: After price = 1.00000000
======================================================================
| Position ID: 1
| Health Ratio: 0.77232592
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1035.83211361 (BORROWED)
|   -> Value: 1035.83211361 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 800.00000000 MOET
|   Utilization Rate: 129.47901400%
======================================================================

Test results: "./cadence/tests/price_scenario_test.cdc"
- PASS: testExtremePriceMovements
- PASS: testGradualPriceChanges
- PASS: testVolatilePriceSwings
Coverage: 74.9% of statements
Running test: testGradualPriceChanges

======================================================================
|== AUTO-BORROW SCENARIO: Extreme FLOW Price Volatility
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| [PRICE UPDATE] Setting MOET price
|    Token Identifier: A.0000000000000008.MOET.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Creating position with 1000 FLOW...
Using position ID: 1
Initial position health: 1.30000000

======================================================================
|== Stage 0: FLOW drops 50% to 0.5
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.65000000
Triggering rebalance...
Health after rebalance: 0.86666666

======================================================================
| POSITION STATE: After price = 0.50000000
======================================================================
| Position ID: 1
| Health Ratio: 0.86666666
======================================================================
| PRICES:
|   FLOW: 0.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 461.53846154 (BORROWED)
|   -> Value: 461.53846154 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 500.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 400.00000000 MOET
|   Utilization Rate: 115.38461500%
======================================================================


======================================================================
|== Stage 1: FLOW crashes 90% to 0.1
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.10000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.17333333
Triggering rebalance...
Health after rebalance: 0.19597989

======================================================================
| POSITION STATE: After price = 0.10000000
======================================================================
| Position ID: 1
| Health Ratio: 0.19597989
======================================================================
| PRICES:
|   FLOW: 0.10000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 408.20512805 (BORROWED)
|   -> Value: 408.20512805 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 100.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 80.00000000 MOET
|   Utilization Rate: 510.25641000%
======================================================================


======================================================================
|== Stage 2: FLOW recovers to 2.0 (2x original)
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 2.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 3.91959799
Triggering rebalance...
Health after rebalance: 1.30000000

======================================================================
| POSITION STATE: After price = 2.00000000
======================================================================
| Position ID: 1
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 2.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1230.76923076 (BORROWED)
|   -> Value: 1230.76923076 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 2000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 1600.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================


======================================================================
|== Stage 3: FLOW moons to 5.0 (5x original)
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 5.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 3.25000000
Triggering rebalance...
Health after rebalance: 1.30000000

======================================================================
| POSITION STATE: After price = 5.00000000
======================================================================
| Position ID: 1
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 5.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 3076.92307692 (BORROWED)
|   -> Value: 3076.92307692 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 5000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 4000.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================


======================================================================
|== Stage 4: FLOW crashes back to 0.25
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.25000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.06500000
Triggering rebalance...
Health after rebalance: 0.06824146

======================================================================
| POSITION STATE: After price = 0.25000000
======================================================================
| Position ID: 1
| Health Ratio: 0.06824146
======================================================================
| PRICES:
|   FLOW: 0.25000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 2930.76923077 (BORROWED)
|   -> Value: 2930.76923077 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 250.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 200.00000000 MOET
|   Utilization Rate: 1465.38461500%
======================================================================


======================================================================
|== Stage 5: FLOW stabilizes at 1.0
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.27296587
Triggering rebalance...
Health after rebalance: 0.32725200

======================================================================
| POSITION STATE: After price = 1.00000000
======================================================================
| Position ID: 1
| Health Ratio: 0.32725200
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 2444.59922841 (BORROWED)
|   -> Value: 2444.59922841 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 800.00000000 MOET
|   Utilization Rate: 305.57490300%
======================================================================


======================================================================
|== AUTO-BALANCER SCENARIO: Gradual YieldToken Price Changes
======================================================================

Creating Tide with TracerStrategy...
Initial AutoBalancer balance: 615.38461538 YieldToken

======================================================================
|== Stage 0: YieldToken +10% to 1.1
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.10000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.10000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 676.92307691
|   -> Value in USD: 676.92307691
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~559.44055943
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 109.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.10000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 676.92307691
|   -> Value in USD: 676.92307691
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~559.44055943
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 109.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Balance UNCHANGED

======================================================================
|== Stage 1: YieldToken +20% to 1.2
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.20000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.20000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 738.46153845
|   -> Value in USD: 738.46153845
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~512.82051281
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 119.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.20000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 738.46153845
|   -> Value in USD: 738.46153845
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~512.82051281
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 119.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Balance UNCHANGED

======================================================================
|== Stage 2: YieldToken +30% to 1.3
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.30000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.30000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 799.99999999
|   -> Value in USD: 799.99999999
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~473.37278106
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 129.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.30000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 799.99999999
|   -> Value in USD: 799.99999999
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~473.37278106
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 129.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Balance UNCHANGED

======================================================================
|== Stage 3: YieldToken +40% to 1.4
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.40000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.40000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 861.53846153
|   -> Value in USD: 861.53846153
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~439.56043955
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 139.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.40000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 861.53846153
|   -> Value in USD: 861.53846153
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~439.56043955
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 139.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Balance UNCHANGED

======================================================================
|== Stage 4: YieldToken +50% to 1.5
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 923.07692307
|   -> Value in USD: 923.07692307
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~410.25641025
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 150.00000000%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 923.07692307
|   -> Value in USD: 923.07692307
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~410.25641025
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 150.00000000%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Balance UNCHANGED

======================================================================
|== Stage 5: YieldToken drops to 1.3
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.30000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.30000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 799.99999999
|   -> Value in USD: 799.99999999
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~473.37278106
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 129.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.30000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 799.99999999
|   -> Value in USD: 799.99999999
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~473.37278106
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 129.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Balance UNCHANGED

======================================================================
|== Stage 6: YieldToken drops to 1.1
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.10000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.10000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 676.92307691
|   -> Value in USD: 676.92307691
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~559.44055943
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 109.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.10000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 676.92307691
|   -> Value in USD: 676.92307691
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~559.44055943
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 109.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Balance UNCHANGED

======================================================================
|== Stage 7: YieldToken drops to 0.9
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 0.90000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 0.90000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 553.84615384
|   -> Value in USD: 553.84615384
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~683.76068375
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 89.99999900%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 0.90000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 589.08612750
|   -> Value in MOET: 530.17751475
|   -> Value in USD: 530.17751475
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~683.76068375
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 86.15384600%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

[WARNING] Potential underflow in balance change
|    Attempting: 589.08612750 - 615.38461538
|    Result would be negative, returning absolute difference
Balance DECREASED by: 26.29848788

======================================================================
|== Stage 8: YieldToken drops to 0.7
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 0.70000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 0.70000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 589.08612750
|   -> Value in MOET: 412.36028925
|   -> Value in USD: 412.36028925
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~879.12087911
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 67.00854700%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 0.70000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 456.72670393
|   -> Value in MOET: 319.70869275
|   -> Value in USD: 319.70869275
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~879.12087911
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 51.95266200%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

[WARNING] Potential underflow in balance change
|    Attempting: 456.72670393 - 615.38461538
|    Result would be negative, returning absolute difference
Balance DECREASED by: 158.65791145

======================================================================
|== Stage 9: YieldToken drops to 0.5
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 0.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 0.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 456.72670393
|   -> Value in MOET: 228.36335196
|   -> Value in USD: 228.36335196
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~1230.76923076
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 37.10904400%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 0.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 281.06258702
|   -> Value in MOET: 140.53129351
|   -> Value in USD: 140.53129351
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~1230.76923076
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 22.83633500%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

[WARNING] Potential underflow in balance change
|    Attempting: 281.06258702 - 615.38461538
|    Result would be negative, returning absolute difference
Balance DECREASED by: 334.32202836

======================================================================
|== AUTO-BORROW SCENARIO: Volatile Price Swings
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| [PRICE UPDATE] Setting MOET price
|    Token Identifier: A.0000000000000008.MOET.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Creating position with 1000 FLOW...
Using position ID: 1
Initial position health: 0.32725200

======================================================================
|== Stage 0: FLOW pumps to 1.5
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.49087800
Triggering rebalance...
Health after rebalance: 0.64168558

======================================================================
| POSITION STATE: After price = 1.50000000
======================================================================
| Position ID: 1
| Health Ratio: 0.64168558
======================================================================
| PRICES:
|   FLOW: 1.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1870.07473137 (BORROWED)
|   -> Value: 1870.07473137 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1500.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 1200.00000000 MOET
|   Utilization Rate: 155.83956000%
======================================================================


======================================================================
|== Stage 1: FLOW dumps to 0.7
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.70000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.29945327
Triggering rebalance...
Health after rebalance: 0.36398318

======================================================================
| POSITION STATE: After price = 0.70000000
======================================================================
| Position ID: 1
| Health Ratio: 0.36398318
======================================================================
| PRICES:
|   FLOW: 0.70000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1538.53261966 (BORROWED)
|   -> Value: 1538.53261966 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 700.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 560.00000000 MOET
|   Utilization Rate: 274.73796700%
======================================================================


======================================================================
|== Stage 2: FLOW pumps to 1.8
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.80000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.93595675
Triggering rebalance...
Health after rebalance: 1.17231202

======================================================================
| POSITION STATE: After price = 1.80000000
======================================================================
| Position ID: 1
| Health Ratio: 1.17231202
======================================================================
| PRICES:
|   FLOW: 1.80000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1228.34192144 (BORROWED)
|   -> Value: 1228.34192144 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1800.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 1440.00000000 MOET
|   Utilization Rate: 85.30152200%
======================================================================


======================================================================
|== Stage 3: FLOW crashes to 0.4
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.40000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.26051378
Triggering rebalance...
Health after rebalance: 0.31022297

======================================================================
| POSITION STATE: After price = 0.40000000
======================================================================
| Position ID: 1
| Health Ratio: 0.31022297
======================================================================
| PRICES:
|   FLOW: 0.40000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1031.51612831 (BORROWED)
|   -> Value: 1031.51612831 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 400.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 320.00000000 MOET
|   Utilization Rate: 322.34879000%
======================================================================


======================================================================
|== Stage 4: FLOW recovers to 1.2
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.20000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.93066891
Triggering rebalance...
Health after rebalance: 1.16828317

======================================================================
| POSITION STATE: After price = 1.20000000
======================================================================
| Position ID: 1
| Health Ratio: 1.16828317
======================================================================
| PRICES:
|   FLOW: 1.20000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 821.71858607 (BORROWED)
|   -> Value: 821.71858607 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1200.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 960.00000000 MOET
|   Utilization Rate: 85.59568600%
======================================================================


======================================================================
|== Stage 5: FLOW drops to 0.9
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.90000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.87621238
Triggering rebalance...
Health after rebalance: 1.12294708

======================================================================
| POSITION STATE: After price = 0.90000000
======================================================================
| Position ID: 1
| Health Ratio: 1.12294708
======================================================================
| PRICES:
|   FLOW: 0.90000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 641.17001424 (BORROWED)
|   -> Value: 641.17001424 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 900.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 720.00000000 MOET
|   Utilization Rate: 89.05139000%
======================================================================


======================================================================
|== Stage 6: FLOW moons to 2.5
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 2.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 3.11929746
Triggering rebalance...
Health after rebalance: 1.30000000

======================================================================
| POSITION STATE: After price = 2.50000000
======================================================================
| Position ID: 1
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 2.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1538.46153846 (BORROWED)
|   -> Value: 1538.46153846 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 2500.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 2000.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================


======================================================================
|== Stage 7: FLOW crashes to 0.3
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.30000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.15600000
Triggering rebalance...
Health after rebalance: 0.17441860

======================================================================
| POSITION STATE: After price = 0.30000000
======================================================================
| Position ID: 1
| Health Ratio: 0.17441860
======================================================================
| PRICES:
|   FLOW: 0.30000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1376.00000000 (BORROWED)
|   -> Value: 1376.00000000 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 300.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 240.00000000 MOET
|   Utilization Rate: 573.33333300%
======================================================================


======================================================================
|== Stage 8: FLOW stabilizes at 1.0
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.58139534
Triggering rebalance...
Health after rebalance: 0.77232592

======================================================================
| POSITION STATE: After price = 1.00000000
======================================================================
| Position ID: 1
| Health Ratio: 0.77232592
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1035.83211361 (BORROWED)
|   -> Value: 1035.83211361 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 800.00000000 MOET
|   Utilization Rate: 129.47901400%
======================================================================

Test results: "./cadence/tests/price_scenario_test.cdc"
- PASS: testExtremePriceMovements
- PASS: testGradualPriceChanges
- PASS: testVolatilePriceSwings
Coverage: 74.9% of statements
Running test: testVolatilePriceSwings

======================================================================
|== AUTO-BORROW SCENARIO: Extreme FLOW Price Volatility
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| [PRICE UPDATE] Setting MOET price
|    Token Identifier: A.0000000000000008.MOET.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Creating position with 1000 FLOW...
Using position ID: 1
Initial position health: 1.30000000

======================================================================
|== Stage 0: FLOW drops 50% to 0.5
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.65000000
Triggering rebalance...
Health after rebalance: 0.86666666

======================================================================
| POSITION STATE: After price = 0.50000000
======================================================================
| Position ID: 1
| Health Ratio: 0.86666666
======================================================================
| PRICES:
|   FLOW: 0.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 461.53846154 (BORROWED)
|   -> Value: 461.53846154 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 500.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 400.00000000 MOET
|   Utilization Rate: 115.38461500%
======================================================================


======================================================================
|== Stage 1: FLOW crashes 90% to 0.1
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.10000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.17333333
Triggering rebalance...
Health after rebalance: 0.19597989

======================================================================
| POSITION STATE: After price = 0.10000000
======================================================================
| Position ID: 1
| Health Ratio: 0.19597989
======================================================================
| PRICES:
|   FLOW: 0.10000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 408.20512805 (BORROWED)
|   -> Value: 408.20512805 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 100.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 80.00000000 MOET
|   Utilization Rate: 510.25641000%
======================================================================


======================================================================
|== Stage 2: FLOW recovers to 2.0 (2x original)
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 2.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 3.91959799
Triggering rebalance...
Health after rebalance: 1.30000000

======================================================================
| POSITION STATE: After price = 2.00000000
======================================================================
| Position ID: 1
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 2.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1230.76923076 (BORROWED)
|   -> Value: 1230.76923076 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 2000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 1600.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================


======================================================================
|== Stage 3: FLOW moons to 5.0 (5x original)
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 5.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 3.25000000
Triggering rebalance...
Health after rebalance: 1.30000000

======================================================================
| POSITION STATE: After price = 5.00000000
======================================================================
| Position ID: 1
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 5.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 3076.92307692 (BORROWED)
|   -> Value: 3076.92307692 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 5000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 4000.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================


======================================================================
|== Stage 4: FLOW crashes back to 0.25
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.25000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.06500000
Triggering rebalance...
Health after rebalance: 0.06824146

======================================================================
| POSITION STATE: After price = 0.25000000
======================================================================
| Position ID: 1
| Health Ratio: 0.06824146
======================================================================
| PRICES:
|   FLOW: 0.25000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 2930.76923077 (BORROWED)
|   -> Value: 2930.76923077 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 250.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 200.00000000 MOET
|   Utilization Rate: 1465.38461500%
======================================================================


======================================================================
|== Stage 5: FLOW stabilizes at 1.0
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.27296587
Triggering rebalance...
Health after rebalance: 0.32725200

======================================================================
| POSITION STATE: After price = 1.00000000
======================================================================
| Position ID: 1
| Health Ratio: 0.32725200
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 2444.59922841 (BORROWED)
|   -> Value: 2444.59922841 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 800.00000000 MOET
|   Utilization Rate: 305.57490300%
======================================================================


======================================================================
|== AUTO-BALANCER SCENARIO: Gradual YieldToken Price Changes
======================================================================

Creating Tide with TracerStrategy...
Initial AutoBalancer balance: 615.38461538 YieldToken

======================================================================
|== Stage 0: YieldToken +10% to 1.1
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.10000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.10000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 676.92307691
|   -> Value in USD: 676.92307691
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~559.44055943
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 109.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.10000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 676.92307691
|   -> Value in USD: 676.92307691
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~559.44055943
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 109.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Balance UNCHANGED

======================================================================
|== Stage 1: YieldToken +20% to 1.2
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.20000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.20000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 738.46153845
|   -> Value in USD: 738.46153845
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~512.82051281
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 119.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.20000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 738.46153845
|   -> Value in USD: 738.46153845
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~512.82051281
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 119.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Balance UNCHANGED

======================================================================
|== Stage 2: YieldToken +30% to 1.3
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.30000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.30000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 799.99999999
|   -> Value in USD: 799.99999999
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~473.37278106
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 129.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.30000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 799.99999999
|   -> Value in USD: 799.99999999
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~473.37278106
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 129.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Balance UNCHANGED

======================================================================
|== Stage 3: YieldToken +40% to 1.4
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.40000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.40000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 861.53846153
|   -> Value in USD: 861.53846153
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~439.56043955
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 139.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.40000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 861.53846153
|   -> Value in USD: 861.53846153
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~439.56043955
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 139.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Balance UNCHANGED

======================================================================
|== Stage 4: YieldToken +50% to 1.5
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 923.07692307
|   -> Value in USD: 923.07692307
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~410.25641025
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 150.00000000%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 923.07692307
|   -> Value in USD: 923.07692307
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~410.25641025
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 150.00000000%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Balance UNCHANGED

======================================================================
|== Stage 5: YieldToken drops to 1.3
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.30000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.30000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 799.99999999
|   -> Value in USD: 799.99999999
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~473.37278106
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 129.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.30000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 799.99999999
|   -> Value in USD: 799.99999999
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~473.37278106
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 129.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Balance UNCHANGED

======================================================================
|== Stage 6: YieldToken drops to 1.1
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.10000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.10000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 676.92307691
|   -> Value in USD: 676.92307691
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~559.44055943
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 109.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.10000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 676.92307691
|   -> Value in USD: 676.92307691
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~559.44055943
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 109.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Balance UNCHANGED

======================================================================
|== Stage 7: YieldToken drops to 0.9
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 0.90000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 0.90000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 553.84615384
|   -> Value in USD: 553.84615384
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~683.76068375
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 89.99999900%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 0.90000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 589.08612750
|   -> Value in MOET: 530.17751475
|   -> Value in USD: 530.17751475
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~683.76068375
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 86.15384600%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

[WARNING] Potential underflow in balance change
|    Attempting: 589.08612750 - 615.38461538
|    Result would be negative, returning absolute difference
Balance DECREASED by: 26.29848788

======================================================================
|== Stage 8: YieldToken drops to 0.7
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 0.70000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 0.70000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 589.08612750
|   -> Value in MOET: 412.36028925
|   -> Value in USD: 412.36028925
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~879.12087911
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 67.00854700%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 0.70000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 456.72670393
|   -> Value in MOET: 319.70869275
|   -> Value in USD: 319.70869275
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~879.12087911
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 51.95266200%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

[WARNING] Potential underflow in balance change
|    Attempting: 456.72670393 - 615.38461538
|    Result would be negative, returning absolute difference
Balance DECREASED by: 158.65791145

======================================================================
|== Stage 9: YieldToken drops to 0.5
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 0.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 0.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 456.72670393
|   -> Value in MOET: 228.36335196
|   -> Value in USD: 228.36335196
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~1230.76923076
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 37.10904400%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

Triggering rebalance...

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 0.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 281.06258702
|   -> Value in MOET: 140.53129351
|   -> Value in USD: 140.53129351
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~1230.76923076
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 22.83633500%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

[WARNING] Potential underflow in balance change
|    Attempting: 281.06258702 - 615.38461538
|    Result would be negative, returning absolute difference
Balance DECREASED by: 334.32202836

======================================================================
|== AUTO-BORROW SCENARIO: Volatile Price Swings
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| [PRICE UPDATE] Setting MOET price
|    Token Identifier: A.0000000000000008.MOET.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Creating position with 1000 FLOW...
Using position ID: 1
Initial position health: 0.32725200

======================================================================
|== Stage 0: FLOW pumps to 1.5
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.49087800
Triggering rebalance...
Health after rebalance: 0.64168558

======================================================================
| POSITION STATE: After price = 1.50000000
======================================================================
| Position ID: 1
| Health Ratio: 0.64168558
======================================================================
| PRICES:
|   FLOW: 1.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1870.07473137 (BORROWED)
|   -> Value: 1870.07473137 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1500.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 1200.00000000 MOET
|   Utilization Rate: 155.83956000%
======================================================================


======================================================================
|== Stage 1: FLOW dumps to 0.7
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.70000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.29945327
Triggering rebalance...
Health after rebalance: 0.36398318

======================================================================
| POSITION STATE: After price = 0.70000000
======================================================================
| Position ID: 1
| Health Ratio: 0.36398318
======================================================================
| PRICES:
|   FLOW: 0.70000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1538.53261966 (BORROWED)
|   -> Value: 1538.53261966 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 700.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 560.00000000 MOET
|   Utilization Rate: 274.73796700%
======================================================================


======================================================================
|== Stage 2: FLOW pumps to 1.8
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.80000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.93595675
Triggering rebalance...
Health after rebalance: 1.17231202

======================================================================
| POSITION STATE: After price = 1.80000000
======================================================================
| Position ID: 1
| Health Ratio: 1.17231202
======================================================================
| PRICES:
|   FLOW: 1.80000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1228.34192144 (BORROWED)
|   -> Value: 1228.34192144 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1800.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 1440.00000000 MOET
|   Utilization Rate: 85.30152200%
======================================================================


======================================================================
|== Stage 3: FLOW crashes to 0.4
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.40000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.26051378
Triggering rebalance...
Health after rebalance: 0.31022297

======================================================================
| POSITION STATE: After price = 0.40000000
======================================================================
| Position ID: 1
| Health Ratio: 0.31022297
======================================================================
| PRICES:
|   FLOW: 0.40000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1031.51612831 (BORROWED)
|   -> Value: 1031.51612831 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 400.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 320.00000000 MOET
|   Utilization Rate: 322.34879000%
======================================================================


======================================================================
|== Stage 4: FLOW recovers to 1.2
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.20000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.93066891
Triggering rebalance...
Health after rebalance: 1.16828317

======================================================================
| POSITION STATE: After price = 1.20000000
======================================================================
| Position ID: 1
| Health Ratio: 1.16828317
======================================================================
| PRICES:
|   FLOW: 1.20000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 821.71858607 (BORROWED)
|   -> Value: 821.71858607 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1200.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 960.00000000 MOET
|   Utilization Rate: 85.59568600%
======================================================================


======================================================================
|== Stage 5: FLOW drops to 0.9
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.90000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.87621238
Triggering rebalance...
Health after rebalance: 1.12294708

======================================================================
| POSITION STATE: After price = 0.90000000
======================================================================
| Position ID: 1
| Health Ratio: 1.12294708
======================================================================
| PRICES:
|   FLOW: 0.90000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 641.17001424 (BORROWED)
|   -> Value: 641.17001424 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 900.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 720.00000000 MOET
|   Utilization Rate: 89.05139000%
======================================================================


======================================================================
|== Stage 6: FLOW moons to 2.5
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 2.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 3.11929746
Triggering rebalance...
Health after rebalance: 1.30000000

======================================================================
| POSITION STATE: After price = 2.50000000
======================================================================
| Position ID: 1
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 2.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1538.46153846 (BORROWED)
|   -> Value: 1538.46153846 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 2500.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 2000.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================


======================================================================
|== Stage 7: FLOW crashes to 0.3
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.30000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.15600000
Triggering rebalance...
Health after rebalance: 0.17441860

======================================================================
| POSITION STATE: After price = 0.30000000
======================================================================
| Position ID: 1
| Health Ratio: 0.17441860
======================================================================
| PRICES:
|   FLOW: 0.30000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1376.00000000 (BORROWED)
|   -> Value: 1376.00000000 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 300.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 240.00000000 MOET
|   Utilization Rate: 573.33333300%
======================================================================


======================================================================
|== Stage 8: FLOW stabilizes at 1.0
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.58139534
Triggering rebalance...
Health after rebalance: 0.77232592

======================================================================
| POSITION STATE: After price = 1.00000000
======================================================================
| Position ID: 1
| Health Ratio: 0.77232592
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1035.83211361 (BORROWED)
|   -> Value: 1035.83211361 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 800.00000000 MOET
|   Utilization Rate: 129.47901400%
======================================================================

Test results: "./cadence/tests/price_scenario_test.cdc"
- PASS: testExtremePriceMovements
- PASS: testGradualPriceChanges
- PASS: testVolatilePriceSwings
Coverage: 74.9% of statements

[2/10] Testing edge cases (zero, micro, extreme prices)...

======================================================================
|== AUTO-BORROW SCENARIO: Edge Prices - Auto-Borrow
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| [PRICE UPDATE] Setting MOET price
|    Token Identifier: A.0000000000000008.MOET.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Creating position with 1000 FLOW...
Initial position health: 1.30000000

======================================================================
|== Stage 0: Zero
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.00000000
Triggering rebalance...
Health after rebalance: 1.00000000

======================================================================
| POSITION STATE: After price = 0.00000000
======================================================================
| Position ID: 0
| Health Ratio: 1.00000000
======================================================================
| PRICES:
|   FLOW: 0.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 0.00000000 (DEPOSITED)
|   -> Value: 0.00000000 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 0.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 0.00000000 MOET
|   Utilization Rate: 0.00000000%
======================================================================


======================================================================
|== Stage 1: Micro
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.00000001 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 1.00000000
Triggering rebalance...
Health after rebalance: 1.30081300

======================================================================
| POSITION STATE: After price = 0.00000001
======================================================================
| Position ID: 0
| Health Ratio: 1.30081300
======================================================================
| PRICES:
|   FLOW: 0.00000001 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 0.00000615 (BORROWED)
|   -> Value: 0.00000615 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 0.00001000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 0.00000800 MOET
|   Utilization Rate: 76.87500000%
======================================================================


======================================================================
|== Stage 2: VeryHigh
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1000.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 130081300813.00813008
Triggering rebalance...
Health after rebalance: 1.30000000

======================================================================
| POSITION STATE: After price = 1000.00000000
======================================================================
| Position ID: 0
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 1000.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 615384.61538461 (BORROWED)
|   -> Value: 615384.61538461 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1000000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 800000.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================


Generated test file: ./cadence/tests/generated_price_test.cdc
Running auto-borrow test with 3 price points...
Scenario: Edge Prices
Prices: [0.0, 1e-08, 1000.0]


Test results: "./cadence/tests/generated_price_test.cdc"
- PASS: testCustomPriceScenario
Coverage: 58.4% of statements



[3/10] Testing price extremes (0.001 to 500x)...

======================================================================
|== AUTO-BORROW SCENARIO: Price Extremes - Auto-Borrow
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| [PRICE UPDATE] Setting MOET price
|    Token Identifier: A.0000000000000008.MOET.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Creating position with 1000 FLOW...
Initial position health: 1.30000000

======================================================================
|== Stage 0: VeryLow
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.00100000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.00130000
Triggering rebalance...
Health after rebalance: 0.00130129

======================================================================
| POSITION STATE: After price = 0.00100000
======================================================================
| Position ID: 0
| Health Ratio: 0.00130129
======================================================================
| PRICES:
|   FLOW: 0.00100000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 614.76984615 (BORROWED)
|   -> Value: 614.76984615 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 0.80000000 MOET
|   Utilization Rate: 76846.23076800%
======================================================================


======================================================================
|== Stage 1: 10x
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 10.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 13.01299998
Triggering rebalance...
Health after rebalance: 1.30000000

======================================================================
| POSITION STATE: After price = 10.00000000
======================================================================
| Position ID: 0
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 10.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 6153.84615384 (BORROWED)
|   -> Value: 6153.84615384 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 10000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 8000.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================


======================================================================
|== Stage 2: 100x
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 100.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 13.00000000
Triggering rebalance...
Health after rebalance: 1.30000000

======================================================================
| POSITION STATE: After price = 100.00000000
======================================================================
| Position ID: 0
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 100.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 61538.46153846 (BORROWED)
|   -> Value: 61538.46153846 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 100000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 80000.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================


======================================================================
|== Stage 3: 500x
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 500.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 6.50000000
Triggering rebalance...
Health after rebalance: 1.30000000

======================================================================
| POSITION STATE: After price = 500.00000000
======================================================================
| Position ID: 0
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 500.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 307692.30769230 (BORROWED)
|   -> Value: 307692.30769230 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 500000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 400000.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================


Generated test file: ./cadence/tests/generated_price_test.cdc
Running auto-borrow test with 4 price points...
Scenario: Price Extremes
Prices: [0.001, 10.0, 100.0, 500.0]


Test results: "./cadence/tests/generated_price_test.cdc"
- PASS: testCustomPriceScenario
Coverage: 57.8% of statements



[4/10] Testing rapid oscillations...

======================================================================
|== AUTO-BORROW SCENARIO: Rapid Oscillations - Auto-Borrow
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| [PRICE UPDATE] Setting MOET price
|    Token Identifier: A.0000000000000008.MOET.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Creating position with 1000 FLOW...
Initial position health: 1.30000000

======================================================================
|== Stage 0: Start
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 1.30000000
Triggering rebalance...
Health after rebalance: 1.30000000

======================================================================
| POSITION STATE: After price = 1.00000000
======================================================================
| Position ID: 0
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 615.38461538 (BORROWED)
|   -> Value: 615.38461538 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 800.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================


======================================================================
|== Stage 1: 2x
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 2.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 2.60000000
Triggering rebalance...
Health after rebalance: 1.30000000

======================================================================
| POSITION STATE: After price = 2.00000000
======================================================================
| Position ID: 0
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 2.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1230.76923076 (BORROWED)
|   -> Value: 1230.76923076 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 2000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 1600.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================


======================================================================
|== Stage 2: Drop50%
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.32500000
Triggering rebalance...
Health after rebalance: 0.40000000

======================================================================
| POSITION STATE: After price = 0.50000000
======================================================================
| Position ID: 0
| Health Ratio: 0.40000000
======================================================================
| PRICES:
|   FLOW: 0.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1000.00000000 (BORROWED)
|   -> Value: 1000.00000000 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 500.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 400.00000000 MOET
|   Utilization Rate: 250.00000000%
======================================================================


======================================================================
|== Stage 3: 3x
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 3.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 2.40000000
Triggering rebalance...
Health after rebalance: 1.30000000

======================================================================
| POSITION STATE: After price = 3.00000000
======================================================================
| Position ID: 0
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 3.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1846.15384615 (BORROWED)
|   -> Value: 1846.15384615 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 3000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 2400.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================


======================================================================
|== Stage 4: Crash70%
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.30000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.13000000
Triggering rebalance...
Health after rebalance: 0.14285714

======================================================================
| POSITION STATE: After price = 0.30000000
======================================================================
| Position ID: 0
| Health Ratio: 0.14285714
======================================================================
| PRICES:
|   FLOW: 0.30000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1680.00000000 (BORROWED)
|   -> Value: 1680.00000000 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 300.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 240.00000000 MOET
|   Utilization Rate: 700.00000000%
======================================================================


======================================================================
|== Stage 5: Recover1.5x
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.71428571
Triggering rebalance...
Health after rebalance: 0.94928583

======================================================================
| POSITION STATE: After price = 1.50000000
======================================================================
| Position ID: 0
| Health Ratio: 0.94928583
======================================================================
| PRICES:
|   FLOW: 1.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1264.10819645 (BORROWED)
|   -> Value: 1264.10819645 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1500.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 1200.00000000 MOET
|   Utilization Rate: 105.34234900%
======================================================================


======================================================================
|== Stage 6: Drop20%
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.80000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.50628577
Triggering rebalance...
Health after rebalance: 0.66422424

======================================================================
| POSITION STATE: After price = 0.80000000
======================================================================
| Position ID: 0
| Health Ratio: 0.66422424
======================================================================
| PRICES:
|   FLOW: 0.80000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 963.53002651 (BORROWED)
|   -> Value: 963.53002651 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 800.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 640.00000000 MOET
|   Utilization Rate: 150.55156600%
======================================================================


======================================================================
|== Stage 7: 2.5x
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 2.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 2.07570075
Triggering rebalance...
Health after rebalance: 1.30000000

======================================================================
| POSITION STATE: After price = 2.50000000
======================================================================
| Position ID: 0
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 2.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1538.46153846 (BORROWED)
|   -> Value: 1538.46153846 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 2500.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 2000.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================


======================================================================
|== Stage 8: Stabilize
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.52000000
Triggering rebalance...
Health after rebalance: 0.68421052

======================================================================
| POSITION STATE: After price = 1.00000000
======================================================================
| Position ID: 0
| Health Ratio: 0.68421052
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 1169.23076923 (BORROWED)
|   -> Value: 1169.23076923 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 800.00000000 MOET
|   Utilization Rate: 146.15384600%
======================================================================


Generated test file: ./cadence/tests/generated_price_test.cdc
Running auto-borrow test with 9 price points...
Scenario: Rapid Oscillations
Prices: [1.0, 2.0, 0.5, 3.0, 0.3, 1.5, 0.8, 2.5, 1.0]


Test results: "./cadence/tests/generated_price_test.cdc"
- PASS: testCustomPriceScenario
Coverage: 59.2% of statements



[5/10] Testing black swan event (99% crash)...

======================================================================
|== AUTO-BORROW SCENARIO: Black Swan Event - Auto-Borrow
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| [PRICE UPDATE] Setting MOET price
|    Token Identifier: A.0000000000000008.MOET.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Creating position with 1000 FLOW...
Initial position health: 1.30000000

======================================================================
|== Stage 0: Normal
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 1.30000000
Triggering rebalance...
Health after rebalance: 1.30000000

======================================================================
| POSITION STATE: After price = 1.00000000
======================================================================
| Position ID: 0
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 615.38461538 (BORROWED)
|   -> Value: 615.38461538 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 800.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================


======================================================================
|== Stage 1: Crash95%
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.05000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.06500000
Triggering rebalance...
Health after rebalance: 0.06824146

======================================================================
| POSITION STATE: After price = 0.05000000
======================================================================
| Position ID: 0
| Health Ratio: 0.06824146
======================================================================
| PRICES:
|   FLOW: 0.05000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 586.15384615 (BORROWED)
|   -> Value: 586.15384615 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 50.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 40.00000000 MOET
|   Utilization Rate: 1465.38461500%
======================================================================


======================================================================
|== Stage 2: Crash99%
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.01000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.01364829
Triggering rebalance...
Health after rebalance: 0.01379156

======================================================================
| POSITION STATE: After price = 0.01000000
======================================================================
| Position ID: 0
| Health Ratio: 0.01379156
======================================================================
| PRICES:
|   FLOW: 0.01000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 580.06460729 (BORROWED)
|   -> Value: 580.06460729 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 10.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 8.00000000 MOET
|   Utilization Rate: 7250.80759100%
======================================================================


======================================================================
|== Stage 3: Recovery50%
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.68957835
Triggering rebalance...
Health after rebalance: 0.91830292

======================================================================
| POSITION STATE: After price = 0.50000000
======================================================================
| Position ID: 0
| Health Ratio: 0.91830292
======================================================================
| PRICES:
|   FLOW: 0.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 435.58611025 (BORROWED)
|   -> Value: 435.58611025 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 500.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 400.00000000 MOET
|   Utilization Rate: 108.89652700%
======================================================================


======================================================================
|== Stage 4: FullRecovery
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 1.83660585
Triggering rebalance...
Health after rebalance: 1.30000000

======================================================================
| POSITION STATE: After price = 1.00000000
======================================================================
| Position ID: 0
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 615.38461538 (BORROWED)
|   -> Value: 615.38461538 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 800.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================


======================================================================
|== Stage 5: Overshoot
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 1.95000000
Triggering rebalance...
Health after rebalance: 1.30000000

======================================================================
| POSITION STATE: After price = 1.50000000
======================================================================
| Position ID: 0
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 1.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 923.07692307 (BORROWED)
|   -> Value: 923.07692307 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1500.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 1200.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================


Generated test file: ./cadence/tests/generated_price_test.cdc
Running auto-borrow test with 6 price points...
Scenario: Black Swan Event
Prices: [1.0, 0.05, 0.01, 0.5, 1.0, 1.5]


Test results: "./cadence/tests/generated_price_test.cdc"
- PASS: testCustomPriceScenario
Coverage: 58.4% of statements



[6/10] Testing MOET depeg scenario...

======================================================================
|== MOET DEPEG SCENARIO TEST
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| [PRICE UPDATE] Setting MOET price
|    Token Identifier: A.0000000000000008.MOET.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Creating position with 1000 FLOW...

======================================================================
|== Stage 1: MOET loses peg - drops to 0.5
======================================================================


======================================================================
| [PRICE UPDATE] Setting MOET price
|    Token Identifier: A.0000000000000008.MOET.Vault
|    New Price: 0.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 1.30000000
Health after rebalance: 1.30000000
OBSERVATION: When MOET depegs, the position health should improve because debt is denominated in MOET

======================================================================
|== Stage 2: FLOW also drops to 0.5
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.65000000
Health after rebalance: 0.86666666
OBSERVATION: With both tokens at 0.5, position should be similar to original state

======================================================================
|== Stage 3: MOET crashes to 0.1 while FLOW stays at 0.5
======================================================================


======================================================================
| [PRICE UPDATE] Setting MOET price
|    Token Identifier: A.0000000000000008.MOET.Vault
|    New Price: 0.10000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health before rebalance: 0.86666666
OBSERVATION: Extreme MOET crash should make debt very cheap, improving health dramatically
Health after rebalance: 1.11428571

======================================================================
| POSITION STATE: After extreme MOET depeg
======================================================================
| Position ID: 0
| Health Ratio: 1.11428571
======================================================================
| PRICES:
|   FLOW: 0.50000000 MOET
|   MOET: 0.10000000 (DEPEGGED)
======================================================================
| BALANCES:
|   MOET Debt: 358.97435740 (BORROWED)
|   -> Value: 358.97435740 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 50.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 40.00000000 MOET
|   Utilization Rate: 897.43589300%
======================================================================

Test results: "cadence/tests/moet_depeg_test.cdc"
- PASS: testMOETDepegScenario

[7/10] Testing concurrent rebalancing...

======================================================================
|== CONCURRENT REBALANCING TEST
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| [PRICE UPDATE] Setting MOET price
|    Token Identifier: A.0000000000000008.MOET.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Creating position with 1000 FLOW...
Initial health: 1.30000000

======================================================================
|== Rapid price changes and rebalancing
======================================================================


Quick change #0: FLOW = 0.80000000

======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.80000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health: 1.04000000
Double rebalance attempt...
Health after 1st rebalance: 1.23809523
Health after 2nd rebalance: 1.29691212

Quick change #1: FLOW = 1.20000000

======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.20000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health: 1.94536818
Health after rebalance: 1.30000000

Quick change #2: FLOW = 0.90000000

======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.90000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health: 0.97500000
Double rebalance attempt...
Health after 1st rebalance: 1.20000000
Health after 2nd rebalance: 1.29171974

Quick change #3: FLOW = 1.10000000

======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.10000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health: 1.57876857
Health after rebalance: 1.30000000

Quick change #4: FLOW = 0.70000000

======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.70000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health: 0.82727272
Double rebalance attempt...
Health after 1st rebalance: 1.07634409
Health after 2nd rebalance: 1.25513010

Quick change #5: FLOW = 1.30000000

======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.30000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================

Health: 2.33095591
Health after rebalance: 1.30000000

======================================================================
|== Final State
======================================================================


======================================================================
| POSITION STATE: After rapid changes
======================================================================
| Position ID: 0
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 0.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 800.00000000 (BORROWED)
|   -> Value: 800.00000000 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 500.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 400.00000000 MOET
|   Utilization Rate: 200.00000000%
======================================================================

Checking final position state...
Final health: 1.30000000
Test results: "cadence/tests/concurrent_rebalance_test.cdc"
- PASS: testConcurrentRebalancing

[8/10] Testing mixed scenario (auto-borrow + auto-balancer simultaneous)...

======================================================================
|== MIXED SCENARIO: Auto-Borrow + Auto-Balancer Simultaneous
======================================================================

Creating auto-borrow position with 1000 FLOW...
Using position ID: 1
Creating auto-balancer Tide with 1000 FLOW...

======================================================================
|== Stage 0: Baseline
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


==================== BEFORE REBALANCING ====================

======================================================================
| POSITION STATE: Before Rebalance
======================================================================
| Position ID: 1
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 615.38461538 (BORROWED)
|   -> Value: 615.38461538 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 800.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================

Auto-Borrow Health: 1.30000000

======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 615.38461538
|   -> Value in USD: 615.38461538
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~615.38461538
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 100.00000000%
|   Status: WITHIN threshold (95-105%) - no rebalance needed
======================================================================

Auto-Balancer Balance: 615.38461538 YieldToken

Triggering rebalances...

======================================================================
| POSITION STATE: After Rebalance
======================================================================
| Position ID: 1
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 615.38461538 (BORROWED)
|   -> Value: 615.38461538 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1000.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 800.00000000 MOET
|   Utilization Rate: 76.92307600%
======================================================================

Auto-Borrow Health: 1.30000000

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.00000000 MOET
|   YieldToken: 1.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 615.38461538
|   -> Value in USD: 615.38461538
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1000.00000000 MOET
|   Expected MOET Borrowed: ~615.38461538
|   Expected YieldTokens: ~615.38461538
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 100.00000000%
|   Status: WITHIN threshold (95-105%) - no rebalance needed
======================================================================

Auto-Balancer Balance: 615.38461538 YieldToken

----------------------------------------------------------------------
| STATE CHANGES AFTER: Rebalancing
----------------------------------------------------------------------
----------------------------------------------------------------------


======================================================================
|== Stage 1: FLOW crash, YieldToken rise
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 1.20000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


==================== BEFORE REBALANCING ====================

======================================================================
| POSITION STATE: Before Rebalance
======================================================================
| Position ID: 1
| Health Ratio: 0.65000000
======================================================================
| PRICES:
|   FLOW: 0.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 615.38461538 (BORROWED)
|   -> Value: 615.38461538 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 500.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 400.00000000 MOET
|   Utilization Rate: 153.84615300%
======================================================================

Auto-Borrow Health: 0.65000000

======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 0.50000000 MOET
|   YieldToken: 1.20000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 615.38461538
|   -> Value in MOET: 738.46153845
|   -> Value in USD: 738.46153845
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 500.00000000 MOET
|   Expected MOET Borrowed: ~307.69230769
|   Expected YieldTokens: ~256.41025640
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 239.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Auto-Balancer Balance: 615.38461538 YieldToken

Triggering rebalances...

======================================================================
| POSITION STATE: After Rebalance
======================================================================
| Position ID: 1
| Health Ratio: 0.86666666
======================================================================
| PRICES:
|   FLOW: 0.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 461.53846154 (BORROWED)
|   -> Value: 461.53846154 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 500.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 400.00000000 MOET
|   Utilization Rate: 115.38461500%
======================================================================

Auto-Borrow Health: 0.86666666

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 0.50000000 MOET
|   YieldToken: 1.20000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 487.17948718
|   -> Value in MOET: 584.61538461
|   -> Value in USD: 584.61538461
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 500.00000000 MOET
|   Expected MOET Borrowed: ~307.69230769
|   Expected YieldTokens: ~256.41025640
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 189.99999900%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Auto-Balancer Balance: 487.17948718 YieldToken

----------------------------------------------------------------------
| STATE CHANGES AFTER: Rebalancing
----------------------------------------------------------------------
| Health: 0.65000000 -> 0.86666666 (+0.21666666)
| MOET Debt: 615.38461538 -> 461.53846154 (-153.84615384)
| YieldToken: 615.38461538 -> 487.17948718 (-128.20512820)
----------------------------------------------------------------------


======================================================================
|== Stage 2: FLOW rise, YieldToken drop
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 1.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 0.80000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


==================== BEFORE REBALANCING ====================

======================================================================
| POSITION STATE: Before Rebalance
======================================================================
| Position ID: 1
| Health Ratio: 2.59999999
======================================================================
| PRICES:
|   FLOW: 1.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 461.53846154 (BORROWED)
|   -> Value: 461.53846154 MOET
|   FLOW Collateral: 1000.00000000
|   -> Value: 1500.00000000 MOET
======================================================================
| METRICS:
|   Effective Collateral: 1200.00000000 MOET
|   Utilization Rate: 38.46153800%
======================================================================

Auto-Borrow Health: 2.59999999

======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.50000000 MOET
|   YieldToken: 0.80000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 487.17948718
|   -> Value in MOET: 389.74358974
|   -> Value in USD: 389.74358974
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1500.00000000 MOET
|   Expected MOET Borrowed: ~923.07692307
|   Expected YieldTokens: ~1153.84615383
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 42.22222200%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

Auto-Balancer Balance: 487.17948718 YieldToken

Triggering rebalances...

======================================================================
| POSITION STATE: After Rebalance
======================================================================
| Position ID: 1
| Health Ratio: 1.30000000
======================================================================
| PRICES:
|   FLOW: 1.50000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 983.03747621 (BORROWED)
|   -> Value: 983.03747621 MOET
|   FLOW Collateral: 1064.95726590
|   -> Value: 1597.43589885 MOET
======================================================================
| METRICS:
|   Effective Collateral: 1277.94871908 MOET
|   Utilization Rate: 76.92307600%
======================================================================

Auto-Borrow Health: 1.30000000

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 1.50000000 MOET
|   YieldToken: 0.80000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 1017.25838118
|   -> Value in MOET: 813.80670494
|   -> Value in USD: 813.80670494
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 1500.00000000 MOET
|   Expected MOET Borrowed: ~923.07692307
|   Expected YieldTokens: ~1153.84615383
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 88.16239300%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

Auto-Balancer Balance: 1017.25838118 YieldToken

----------------------------------------------------------------------
| STATE CHANGES AFTER: Rebalancing
----------------------------------------------------------------------
| Health: 2.59999999 -> 1.30000000 (-1.29999999)
| Collateral: 1000.00000000 -> 1064.95726590 (+64.95726590)
| MOET Debt: 461.53846154 -> 983.03747621 (+521.49901467)
| YieldToken: 487.17948718 -> 1017.25838118 (+530.07889400)
----------------------------------------------------------------------


======================================================================
|== Stage 3: Both crash (MOET slightly depegged)
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 0.30000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 0.50000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| [PRICE UPDATE] Setting MOET price
|    Token Identifier: A.0000000000000008.MOET.Vault
|    New Price: 0.95000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


==================== BEFORE REBALANCING ====================

======================================================================
| POSITION STATE: Before Rebalance
======================================================================
| Position ID: 1
| Health Ratio: 0.25999999
======================================================================
| PRICES:
|   FLOW: 0.30000000 MOET
|   MOET: 0.95000000 (DEPEGGED)
======================================================================
| BALANCES:
|   MOET Debt: 983.03747621 (BORROWED)
|   -> Value: 983.03747621 MOET
|   FLOW Collateral: 1064.95726590
|   -> Value: 303.51282078 MOET
======================================================================
| METRICS:
|   Effective Collateral: 242.81025662 MOET
|   Utilization Rate: 404.85829900%
======================================================================

Auto-Borrow Health: 0.25999999

======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 0.30000000 MOET
|   YieldToken: 0.50000000 MOET
|   MOET: 0.95000000 (DEPEGGED)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 1017.25838118
|   -> Value in MOET: 508.62919059
|   -> Value in USD: 483.19773106
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 300.00000000 MOET
|   Expected MOET Borrowed: ~184.61538461
|   Expected YieldTokens: ~369.23076922
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 275.50747800%
|   Status: ABOVE threshold (>105%) - should rebalance DOWN
======================================================================

Auto-Balancer Balance: 1017.25838118 YieldToken

Triggering rebalances...

======================================================================
| POSITION STATE: After Rebalance
======================================================================
| Position ID: 1
| Health Ratio: 0.64882515
======================================================================
| PRICES:
|   FLOW: 0.30000000 MOET
|   MOET: 0.95000000 (DEPEGGED)
======================================================================
| BALANCES:
|   MOET Debt: 819.82480866 (BORROWED)
|   -> Value: 819.82480866 MOET
|   FLOW Collateral: 2216.34567142
|   -> Value: 631.65851634 MOET
======================================================================
| METRICS:
|   Effective Collateral: 505.32681307 MOET
|   Utilization Rate: 162.23655400%
======================================================================

Auto-Borrow Health: 0.64882515

======================================================================
| AUTO-BALANCER STATE: After Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 0.30000000 MOET
|   YieldToken: 0.50000000 MOET
|   MOET: 0.95000000 (DEPEGGED)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 0.00000000
|   -> Value in MOET: 0.00000000
|   -> Value in USD: 0.00000000
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 300.00000000 MOET
|   Expected MOET Borrowed: ~184.61538461
|   Expected YieldTokens: ~369.23076922
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 0.00000000%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

Auto-Balancer Balance: 0.00000000 YieldToken

----------------------------------------------------------------------
| STATE CHANGES AFTER: Rebalancing
----------------------------------------------------------------------
| Health: 0.25999999 -> 0.64882515 (+0.38882516)
| Collateral: 1064.95726590 -> 2216.34567142 (+1151.38840552)
| MOET Debt: 983.03747621 -> 819.82480866 (-163.21266755)
| YieldToken: 1017.25838118 -> 0.00000000 (-1017.25838118)
----------------------------------------------------------------------


[INTERACTION] Low borrow health may have affected available liquidity for balancer

[INTERACTION] MOET depeg affects both systems - all values impacted

======================================================================
|== Stage 4: Both moon
======================================================================


======================================================================
| [PRICE UPDATE] Setting FLOW price
|    Token Identifier: A.0000000000000003.FlowToken.Vault
|    New Price: 2.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


======================================================================
| [PRICE UPDATE] Setting YieldToken price
|    Token Identifier: A.0000000000000010.YieldToken.Vault
|    New Price: 2.00000000 MOET
|    Previous Price: (not tracked - consider adding if needed)
|    Price update successful
======================================================================


==================== BEFORE REBALANCING ====================

======================================================================
| POSITION STATE: Before Rebalance
======================================================================
| Position ID: 1
| Health Ratio: 4.32550105
======================================================================
| PRICES:
|   FLOW: 2.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| BALANCES:
|   MOET Debt: 819.82480866 (BORROWED)
|   -> Value: 819.82480866 MOET
|   FLOW Collateral: 2216.34567142
|   -> Value: 4432.69134284 MOET
======================================================================
| METRICS:
|   Effective Collateral: 3546.15307427 MOET
|   Utilization Rate: 23.11870800%
======================================================================

Auto-Borrow Health: 4.32550105

======================================================================
| AUTO-BALANCER STATE: Before Rebalance
======================================================================
| Tide ID: 0
| AutoBalancer ID: 0
======================================================================
| PRICES:
|   FLOW: 2.00000000 MOET
|   YieldToken: 2.00000000 MOET
|   MOET: 1.00000000 (pegged)
======================================================================
| HOLDINGS:
|   YieldToken Balance: 0.00000000
|   -> Value in MOET: 0.00000000
|   -> Value in USD: 0.00000000
======================================================================
| POSITION METRICS:
|   Initial FLOW Deposit: 1000.00000000
|   Initial Value: 2000.00000000 MOET
|   Expected MOET Borrowed: ~1230.76923076
|   Expected YieldTokens: ~615.38461538
======================================================================
| PERFORMANCE:
|   Current/Expected Value: 0.00000000%
|   Status: BELOW threshold (<95%) - should rebalance UP
======================================================================

Auto-Balancer Balance: 0.00000000 YieldToken

Triggering rebalances...
Test results: "cadence/tests/mixed_scenario_test.cdc"
- FAIL: testMixedScenario
		Execution failed:
			error: assertion failed: given value is: I.Test.Test.TransactionResult(error: I.Test.Test.Error(message: "[Error Code: 1101] error caused by: 1 error occurred:\n\t* transaction execute failed: [Error Code: 1101] cadence runtime error: Execution failed:\n  --> 8ccb6cef330ed25cf855e017fb4c8cb62eb6c75db1c8389b5ca304e4d2fc6f8d:12:8\n   |\n12 |         self.pool.rebalancePosition(pid: pid, force: force)\n   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n    --> 0000000000000008.TidalProtocol:1216:39\n     |\n1216 |                     let sinkCapacity = drawDownSink.minimumCapacity()\n     |                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n   --> 0000000000000007.SwapStack:204:19\n    |\n204 |             return self.swapper.quoteIn(forDesired: self.sink.minimumCapacity(), reverse: false).inAmount\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n  --> 0000000000000009.MockSwapper:63:19\n   |\n63 |             return self._estimate(amount: forDesired, out: false, reverse: reverse)\n   |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nerror: overflow\n  --> 0000000000000009.MockSwapper:57:12\n   |\n57 |             return self.outVault\n   |             ^^^^^^^^^^^^^^^^^^^^\n\nWas this error unhelpful?\nConsider suggesting an improvement here: https://github.com/onflow/cadence/issues.\n\n\n"), status: I.Test.Test.ResultStatus(rawValue: 1))
			   --> cadence/tests/mixed_scenario_test.cdc:201:4
			
			Was this error unhelpful?
			Consider suggesting an improvement here: https://github.com/onflow/cadence/issues.
			
